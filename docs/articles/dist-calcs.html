<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="compensator">
<title>Distance Calculations • compensator</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Distance Calculations">
<meta property="og:description" content="compensator">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">compensator</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/compensator.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Nonprofit-Open-Data-Collective/compensator/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Distance Calculations</h1>
                        <h4 data-toc-skip class="author">Olivia
Beck</h4>
            
            <h4 data-toc-skip class="date">05 May, 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Nonprofit-Open-Data-Collective/compensator/blob/HEAD/vignettes/dist-calcs.Rmd" class="external-link"><code>vignettes/dist-calcs.Rmd</code></a></small>
      <div class="d-none name"><code>dist-calcs.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="definitions">Definitions<a class="anchor" aria-label="anchor" href="#definitions"></a>
</h2>
<p>We first provide definitions for values used in the distance
calculation.</p>
<div class="section level3">
<h3 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a>
</h3>
<p>Throughout this section, Let <span class="math inline">\(I(Variable1
!= Variable2)\)</span> be 1 when Variable 1 is not the same as Variable
2, 0 when Variable1 = Variable2.</p>
<div class="section level4">
<h4 id="nonprofit-attributes">Nonprofit Attributes<a class="anchor" aria-label="anchor" href="#nonprofit-attributes"></a>
</h4>
<p>For any nonprofit, Organization <span class="math inline">\(i\)</span>, we define the following
characteristics:</p>
<ul>
<li><p><span class="math inline">\(OrgType_i\)</span>, <span class="math inline">\(BroadCategory_i\)</span>, <span class="math inline">\(MajorGroup_i\)</span>, <span class="math inline">\(TwoDigit_i\)</span>, <span class="math inline">\(Division_i\)</span>, and <span class="math inline">\(SubDivision_i\)</span> be the values listed in the
Disaggregated NTEE Codes section of the NTEE codes Vignette.</p></li>
<li><p><span class="math inline">\(LocationType_i\)</span> - “metro”,
“suburban”, “town”, or “rural”, what type of city is Organization <span class="math inline">\(i\)</span> located in? See section ___ for how
this value is determined.</p></li>
<li><p><span class="math inline">\(TotalExpense_i\)</span> be the total
annual expenses of Organization <span class="math inline">\(i\)</span>
the most recent IRS filing year.</p></li>
</ul>
<p>Define similar values of Organization j.</p>
</div>
<div class="section level4">
<h4 id="modified-contiguous-usa-graph">Modified Contiguous USA Graph<a class="anchor" aria-label="anchor" href="#modified-contiguous-usa-graph"></a>
</h4>
<p>To calculate distances between US states and territories we consider
the graph distance on a Modified Contiguous USA Graph. We construct a
graph as follows: each state or territory is represented as a node in
the graph, and there is an edge between two nodes if their respective
states share a border. In this graph, we consider Alaska connected to
Washington, Hawaii connected to California, Puerto Rico connected to
Florida, and Washington D.C. is connected to Maryland and Virginia. The
resulting graph is as follows:</p>
<p><img src="images/modified-usa-graph.png"></p>
<p>The distance between two states is the length of the shortest path
between their respective nodes. Distance between states can be
understood as the number of state borders that you would need to cross
if you were to drive from state A to state B. For example, this distance
between Illinois and Arizona is 4 because the shortest path is from
Illinois, Missouri, Kansas, Colorado, then Arizona.</p>
<p>Note, the minimum distance is 0 and maximum distance between 2 nodes
is 12. The locations pairs with distances of 12 are Alaska and Maine,
and Hawaii and Maine.</p>
<p>We note that because the distance on the Modified Contiguous USA
graph is simply a graph distance, this distance clearly satisfies the
definition of a distance metric as it satisfies non-negativity,
reflexivity, symmetry, and the triangle inequality.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="distance-calculation">Distance Calculation<a class="anchor" aria-label="anchor" href="#distance-calculation"></a>
</h2>
<p>The similarity distance between Organization <span class="math inline">\(i\)</span> and Organization <span class="math inline">\(j\)</span> is a distance measure comprising three
parts: mission distance, geographic distance, and size difference.</p>
<div class="section level4">
<h4 id="mission-distance">Mission Distance<a class="anchor" aria-label="anchor" href="#mission-distance"></a>
</h4>
<p>We use five attributes to calculate the mission distance between
Organization <span class="math inline">\(i\)</span> and Organization
<span class="math inline">\(j\)</span>.</p>
<div class="section level6">
<h6 id="organization-type">1. Organization Type<a class="anchor" aria-label="anchor" href="#organization-type"></a>
</h6>
<p><span class="math display">\[M_{1 , ij} = I( OrgType_i !=OrgType_j
)\]</span></p>
</div>
<div class="section level6">
<h6 id="broad-category">2. Broad Category<a class="anchor" aria-label="anchor" href="#broad-category"></a>
</h6>
<p><span class="math display">\[M_{2 , ij}  = I( BroadCategory_i !=
BroadCategory_j )\]</span></p>
</div>
<div class="section level6">
<h6 id="major-group">3. Major Group<a class="anchor" aria-label="anchor" href="#major-group"></a>
</h6>
<p><span class="math display">\[M_{3 , ij} = \begin{cases} 1  &amp;
\text{ if } M_{2 , ij} = 1 \\ I( MajorGroup_i != MajorGroup_j ) &amp;
\text{ if } M_{2 , ij} = 0 \end{cases}\]</span></p>
</div>
<div class="section level6">
<h6 id="division">4. Division<a class="anchor" aria-label="anchor" href="#division"></a>
</h6>
<p><span class="math display">\[M_{4 , ij}   = \begin{cases} 1  &amp;
\text{ if } M_{3 , ij} = 1 \\ I( Division_i != Division_j )
&amp;  \text{ if }M_{3 , ij} = 0 \end{cases}\]</span></p>
</div>
<div class="section level6">
<h6 id="subdivision">5. Subdivision<a class="anchor" aria-label="anchor" href="#subdivision"></a>
</h6>
<p><span class="math display">\[M_{5 , ij}   = \begin{cases} 1  &amp;
\text{ if } M_{4 , ij} = 1 \\ I( SubDivision_i != SubDivision_j )
&amp;  \text{ if }M_{4 , ij} = 0 \end{cases}\]</span></p>
</div>
<div class="section level6">
<h6 id="total-mission-distance">Total Mission Distance<a class="anchor" aria-label="anchor" href="#total-mission-distance"></a>
</h6>
<p>Then, the final mission distance for two organizations is,</p>
<p><span class="math display">\[\begin{align*}
MissDist_{ij} &amp;= log_{10}\{ (M_{1 , ij}  * WM_1) +(M_{2 , ij}  *
WM_2) +(M_{3 , ij}  * WM_3) \\
&amp;\quad \quad \quad \quad+(M_{4 , ij}  * WM_4) + (M_{5 , ij } *
WM_5)+ 1 \}
\end{align*}\]</span></p>
<p>Where <span class="math inline">\(WM_1\)</span>, <span class="math inline">\(WM_2\)</span>, <span class="math inline">\(WM_3\)</span>, <span class="math inline">\(WM_4\)</span>, and <span class="math inline">\(WM_5\)</span> are the mission weights. See Section
“Weights” below for details.</p>
</div>
</div>
<div class="section level4">
<h4 id="geography">Geography<a class="anchor" aria-label="anchor" href="#geography"></a>
</h4>
<p>We use two values to calculate the geographic distance between
Organization <span class="math inline">\(i\)</span> and Organization
<span class="math inline">\(j\)</span>.</p>
<div class="section level6">
<h6 id="city-location-type-define">1. City Location Type Define,<a class="anchor" aria-label="anchor" href="#city-location-type-define"></a>
</h6>
<p><span class="math display">\[Code_i = \begin{cases}
111 &amp; \text{ if } LocationType_i = ``metro” \\
110 &amp; \text{ if } LocationType_i = ``suburban” \\
100 &amp; \text{ if } LocationType_i = ``town” \\
000 &amp; \text{ if } LocationType_i = ``rural” \\
\end{cases}\]</span></p>
<p>and let <span class="math inline">\(Code_{1, i}\)</span> , <span class="math inline">\(Code_{2, i}\)</span> , and <span class="math inline">\(Code_{3, i}\)</span> be the first, second, and
third digits, of <span class="math inline">\(Code_i\)</span> ,
respectively.</p>
<p>Similarly, define <span class="math inline">\(Code_j\)</span>, <span class="math inline">\(Code_{1, j}\)</span> , <span class="math inline">\(Code_{2, j}\)</span> , and <span class="math inline">\(Code_{3, j}\)</span>.</p>
<p>Then, the geographic distance attributed to the city location type
is,</p>
<p><span class="math display">\[G_{1, ij}= I( Code_{1, i} !=Code_{1, j}
) +I( Code_{2, i} !=Code_{2, j} ) +I( Code_{3, i} !=Code_{3, j}
)\]</span> Since <span class="math inline">\(G_{1, i j}\)</span> is
symmetric in <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, there are seven unique combinations of
Location Types for <span class="math inline">\(G_{1, i j}\)</span> which
we list here.</p>
<ul>
<li>When <span class="math inline">\(LocationType_i =
LocationType_j\)</span>, then <span class="math inline">\(G_{1, ij} =
0\)</span>.</li>
<li>When <span class="math inline">\(LocationType_i =\)</span> “metro”
and <span class="math inline">\(LocationType_j =\)</span> “subruan”,
<span class="math inline">\(G_{1, ij} = 1\)</span>,</li>
<li>When <span class="math inline">\(LocationType_i =\)</span> “metro”
and <span class="math inline">\(LocationType_j =\)</span> “town”, <span class="math inline">\(G_{1, ij} = 2\)</span>,</li>
<li>When <span class="math inline">\(LocationType_i =\)</span>“metro”
and <span class="math inline">\(LocationType_j =\)</span> “rural”, <span class="math inline">\(G_{1, ij} = 3\)</span>,</li>
<li>When <span class="math inline">\(LocationType_i =\)</span>
“suburban” and <span class="math inline">\(LocationType_j =\)</span>
“town”, <span class="math inline">\(G_{1, ij} = 1\)</span>,</li>
<li>When <span class="math inline">\(LocationType_i =\)</span>
“suburban” and <span class="math inline">\(LocationType_j =\)</span>
“rural”, <span class="math inline">\(G_{1, ij} = 2\)</span>,</li>
<li>When <span class="math inline">\(LocationType_i =\)</span> “town”
and <span class="math inline">\(LocationType_j =\)</span> = “rural”,
<span class="math inline">\(G_{1, ij} = 1\)</span>.</li>
</ul>
</div>
<div class="section level6">
<h6 id="state">2. State<a class="anchor" aria-label="anchor" href="#state"></a>
</h6>
<p>Let <span class="math inline">\(StateGraphDist_{ij}\)</span> be the
distance between the state/territory Organization <span class="math inline">\(i\)</span> is located in and the state/territory
Organization <span class="math inline">\(j\)</span> is located in using
the Modified Contiguous USA Graph defined above. Define,</p>
<p><span class="math display">\[G_{2, ij}= StateGraphDist_{i
j}.\]</span></p>
</div>
<div class="section level6">
<h6 id="total-geographic-distance">Total Geographic Distance<a class="anchor" aria-label="anchor" href="#total-geographic-distance"></a>
</h6>
<p>Then, the final geographic distance between the two organizations
is,</p>
<p><span class="math display">\[GeoDist_{ij}=log_{10}\{ (G_{1, ij} *
WG_1 ) +( G_{2, ij} * WG_2 ) + 1 \}.\]</span></p>
</div>
</div>
<div class="section level4">
<h4 id="size">Size<a class="anchor" aria-label="anchor" href="#size"></a>
</h4>
<p>The distance in size between Organization i and Organization j is
calculated as:</p>
<p><span class="math display">\[SizeDist_{ij} = log_{10}(
|TotalExpense_i - TotalExpense_j |  + 1).\]</span></p>
<p>If any information needed to calculate this value is missing we
assign <span class="math inline">\(SizeDist_{ij} = max_{i'.j'}(
SizeDist_{i'j'})\)</span> where <span class="math inline">\(i’\)</span> and <span class="math inline">\(j’\)</span> are all potential pairs of nonprofits
that are being compared.</p>
<div class="section level5">
<h5 id="weights">Weights<a class="anchor" aria-label="anchor" href="#weights"></a>
</h5>
<p>The current weight values are set at</p>
<table class="table">
<thead><tr class="header">
<th align="center">Mission Weights</th>
<th align="center">Geographic Weights</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><span class="math inline">\(WM_1 = 4\)</span></td>
<td align="center"><span class="math inline">\(WG_1 = 1\)</span></td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(WM_2 = 4\)</span></td>
<td align="center"><span class="math inline">\(WG_2 = 1\)</span></td>
</tr>
<tr class="odd">
<td align="center"><span class="math inline">\(WM_3 = 3\)</span></td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(WM_4 = 2\)</span></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td align="center"><span class="math inline">\(WM_5 = 1\)</span></td>
<td align="center"></td>
</tr>
</tbody>
</table>
<p>Need to add reasoning</p>
</div>
</div>
<div class="section level4">
<h4 id="total-distance-score">Total Distance Score<a class="anchor" aria-label="anchor" href="#total-distance-score"></a>
</h4>
<p>To calculate the overall distance we first find,</p>
<ul>
<li><span class="math inline">\(MinMiss = min_{i' j'}
(MissDist_{i' j'} )\)</span></li>
<li><span class="math inline">\(MinGeo= min_{i' j'}
(GeoDist_{i' j'} )\)</span></li>
<li><span class="math inline">\(MinSize = min_{i' j'}
(SizeDist_{i' j '})\)</span></li>
</ul>
<p>Then, the total distance is defined as</p>
<p><span class="math display">\[TotalDist_{i j}  =\frac{100}{3}
(MissDist_{ij}  - MinMiss) + \frac{100}{3}(GeoDist_{ij} - MinGeo)  +
\frac{100}{3}(SizeDist_{ij}  - MinSize). \]</span></p>
<p>By this definition, pairs of organizations with <span class="math inline">\(TotalDist_{ij}=0\)</span> are the most similar of
all potential pairs, and pairs of organizations with <span class="math inline">\(TotalDist_{ij}=100\)</span> are the most
different.</p>
<p>In this definition mission, geography, and size are weighted equally
when calculating the total distance. This implies that these three
attributes are equally important when finding the distance between two
organizations.</p>
<p>However, if you believe that the three attributes are not equally
important, it is possible to update the total distance formula to
reflect this. The current total distance is in the form of an average.
We can instead use a weighted average using weights respective to their
importance. For example if, you believed mission was twice as important
as geography or size, and geography and size are equally important, your
new total distance formula would be</p>
<p><span class="math display">\[TotalDist_{i j}  =\frac{100}{2}
(MissDist_{ij}  - MinMiss) + \frac{100}{4}(GeoDist_{ij} - MinGeo)  +
\frac{100}{4}(SizeDist_{ij}  - MinSize). \]</span></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Olivia Beck, Jessy Lecy, Urban Inistitue National Center for Charitable Statistics.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
